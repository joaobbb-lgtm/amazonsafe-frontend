<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AmazonSafe ‚Äì Monitoramento Ambiental</title>

    <!-- FAVICON -->
    <link rel="icon" type="image/svg+xml" href="assets/logo2.svg">

    <!-- Leaflet MAP -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Fonte -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0f172a;
            font-family: "Inter", sans-serif;
            color: #e2e8f0;
        }

        h1 {
            font-size: 26px;
            font-weight: 700;
            margin: 0;
            color: #fff;
        }

        .header {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.04);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .logo {
            width: 42px;
            height: 42px;
        }

        .container {
            padding: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 12px;
            padding: 20px;
        }

        .title {
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        input, button {
            font-size: 16px;
            padding: 10px;
            border-radius: 8px;
            border: none;
        }

        input {
            width: 100%;
            background: #1e293b;
            color: white;
            border: 1px solid #334155;
        }

        button {
            margin-top: 8px;
            width: 100%;
            background: #10b981;
            color: white;
            cursor: pointer;
            font-weight: 600;
        }

        #map {
            width: 100%;
            height: 350px;
            border-radius: 12px;
            margin-top: 15px;
        }

        .status {
            margin-top: 15px;
        }

        .risk-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .green { background: #065f46; color: #a7f3d0; }
        .yellow { background: #854d0e; color: #fef08a; }
        .red { background: #7f1d1d; color: #fecaca; }
    </style>
</head>

<body>

    <div class="header">
        <img src="assets/logo2.svg" class="logo">
        <h1>AmazonSafe</h1>
    </div>

    <div class="container">

        <!-- ====================== -->
        <!--     Coluna Esquerda    -->
        <!-- ====================== -->
        <div>

            <div class="card">
                <div class="title">Selecione uma Cidade</div>
                <input id="cidadeInput" placeholder="Ex: Bel√©m, Manaus, Marab√°...">
                <button onclick="buscar()">Buscar Dados</button>
            </div>

            <div class="card">
                <div class="title">Mapa</div>
                <div id="map"></div>
            </div>

        </div>

        <!-- ====================== -->
        <!--     Coluna Direita     -->
        <!-- ====================== -->
        <div>

            <div class="card">
                <div class="title">Clima</div>
                <div id="clima"></div>
            </div>

            <div class="card">
                <div class="title">Qualidade do Ar</div>
                <div id="ar"></div>
            </div>

            <div class="card">
                <div class="title">Focos de Calor (INPE)</div>
                <div id="focos"></div>
            </div>

            <div class="card">
                <div class="title">Risco Ambiental (Modelo v10)</div>
                <div id="risco"></div>
            </div>

            <div class="card">
                <div class="title">Status do Backend</div>
                <div id="backend"></div>
            </div>

        </div>

    </div>

<script>
    const API_BASE = "https://amazonsafe-api.onrender.com";

    let map = L.map('map').setView([-1.45, -48.48], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: "¬© OpenStreetMap"
    }).addTo(map);

    let marker;
    let focusLayer = L.layerGroup().addTo(map);

    async function buscar() {
        const cidade = document.getElementById("cidadeInput").value;

        if (!cidade) {
            alert("Digite uma cidade");
            return;
        }

        // =============================
        // CHAMADA AO BACKEND /v2/data
        // =============================
        const url = `${API_BASE}/v2/data?city=${encodeURIComponent(cidade)}`;
        const resp = await fetch(url);
        const data = await resp.json();

        if (!data || !data.location) {
            alert("Cidade n√£o encontrada.");
            return;
        }

        // Atualiza mapa
        const lat = data.location.lat;
        const lon = data.location.lon;

        if (marker) map.removeLayer(marker);
        marker = L.marker([lat, lon]).addTo(map);
        map.setView([lat, lon], 9);

        // Marca focos
        focusLayer.clearLayers();
        data.focos.lista.forEach(f => {
            L.circleMarker([f.lat, f.lon], {
                radius: 5,
                color: "red",
                fillColor: "red",
                fillOpacity: 0.8
            }).addTo(focusLayer);
        });

        // =============================
        // CHAMADA AO MODELO v10
        // =============================

        const entrada = {
            chuva_mm: data.clima.chuva24h || 0,
            pm25: data.ar.pm25 || 0,
            pm10: data.ar.pm10 || 0,
            vento_m_s: data.clima.vento || 0,
            frp: data.focos.frp_medio || 0,
            focos: data.focos.total || 0
        };

        const respAI = await fetch(`${API_BASE}/ai/predict`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(entrada)
        });

        let riscoAI = await respAI.json();

        // =============================
        // Preenche os cards
        // =============================
        document.getElementById("clima").innerHTML = `
            üå°Ô∏è Temp: <b>${data.clima.temp}¬∞C</b><br>
            üíß Umidade: <b>${data.clima.umidade}%</b><br>
            ‚òî Chuva 24h: <b>${data.clima.chuva24h} mm</b><br>
            üí® Vento: <b>${data.clima.vento} m/s</b>
        `;

        document.getElementById("ar").innerHTML = `
            PM2.5: <b>${data.ar.pm25} ¬µg/m¬≥</b><br>
            PM10:  <b>${data.ar.pm10} ¬µg/m¬≥</b><br>
            Esta√ß√£o: <b>${data.ar.estacao}</b>
        `;

        document.getElementById("focos").innerHTML = `
            Total: <b>${data.focos.total}</b> focos<br>
            FRP m√©dio: <b>${data.focos.frp_medio}</b><br>
            √öltimos focos marcados no mapa.
        `;

        const cor = riscoAI.label === "Verde" ? "green" :
                    riscoAI.label === "Amarelo" ? "yellow" : "red";

        document.getElementById("risco").innerHTML = `
            <span class="risk-badge ${cor}">${riscoAI.label}</span>
            <br><br>
            Score: <b>${riscoAI.score}</b> / 100
        `;

        document.getElementById("backend").innerHTML = `
            API Base: ${API_BASE}<br>
            Status: <b>OK</b>
        `;
    }
</script>

</body>
</html>
